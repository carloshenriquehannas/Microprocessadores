;Carlos Henrique Hannas de Carvalho
;NUSP: 11965988

PROG:
		ACALL	INICIAR_LCD
		MOV	R5,#0

LOOP:
		MOV	R4,#7FH
		ACALL	PEGA_TECLA
		ACALL	DECODE
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,R3
		MOV	20H,R3
		ACALL	NBR_TO_ASC
		ACALL	ESCREVE_TEXTO
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,#'+'
		ACALL	ESCREVE_TEXTO
		MOV	R4,#7FH
		ACALL	PEGA_TECLA
		ACALL	DECODE
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,R3
		MOV	21H,R3
		ACALL	NBR_TO_ASC
		ACALL	ESCREVE_TEXTO
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,#'='
		ACALL	ESCREVE_TEXTO
		MOV	A,20H
		MOV	R4,21H
		ADD	A,R4
		MOV	R4,A
		ACALL	HEXATOBCD
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,R6
		ACALL	NBR_TO_ASC
		ACALL	ESCREVE_TEXTO
		MOV	A,R6
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,R7
		ACALL	NBR_TO_ASC
		ACALL	ESCREVE_TEXTO
		MOV	R4,#7FH
		MOV	R5,#0
ENDING:		
		ACALL	PEGA_TECLA
		MOV	A,R2
		ACALL	NBR_TO_ASC
		CJNE	A,#9,MAIORMENOR9
MAIORMENOR9:	
		JC	ENDING
		ACALL	CLEAR_LCD
		SJMP	LOOP

HEXATOBCD:	
		MOV	R6,#0
		MOV	A,R4
		MOV	R7,A
		CJNE	R4,#10,COMPARE
COMPARE:	
		JC	LESSTEN
		MOV	R6,#1
		MOV	A,R7
		SUBB	A,#10
		MOV	R7,A
LESSTEN:	RET

PEGA_TECLA:
		MOV	A,R4		
		MOV	P1,A
		RR	A
		MOV	R4,A
		JB	A.3,NOTRESET	
		MOV	R4,#7FH
NOTRESET:	
		MOV	A,P1
		MOV	R2,A
		ORL	A,#0F0H
		CJNE	A,#0FFH,RETORNA_TECLA
		SJMP	PEGA_TECLA

RETORNA_TECLA:		RET

CLEAR_LCD:	
		CLR	P3.3
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#01H
		CLR	P3.2
		RET

INICIAR_LCD:
		CLR	P3.3
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#38H
		CLR	P3.2
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#0EH
		CLR	P3.2
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#06H
		CLR	P3.2
		RET

POS_LCD:	
		CLR	P3.3
		SETB	P3.2
		CLR	P3.4
		ADD	A,#80H
		MOV	P2,A
		CLR	P3.2
		RET

ESCREVE_TEXTO:		
		CLR	P3.3
		SETB	P3.2
		SETB	P3.4
		MOV	P2,A
		CLR	P3.2
		RET

NBR_TO_ASC:
		CJNE	A,#0AH,TEST
TEST:		
		JC	NUM
		ADD	A,#07H
NUM:		
		ADD	A,#30H
		RET

DECODE:
		CJNE	R2,#0D7H,NOT_0
		MOV	R3,#0
		SJMP	END_DECODE
NOT_0:		
		CJNE	R2,#0EEH,NOT_1
		MOV	R3,#1
		SJMP	END_DECODE
NOT_1:		
		CJNE	R2,#0DEH,NOT_2
		MOV	R3,#2
		SJMP	END_DECODE
NOT_2:		
		CJNE	R2,#0BEH,NOT_3
		MOV	R3,#3
		SJMP	END_DECODE
NOT_3:			
		CJNE	R2,#0EDH,NOT_4
		MOV	R3,#4
		SJMP	END_DECODE
NOT_4:		
		CJNE	R2,#0DDH,NOT_5
		MOV	R3,#5
		SJMP	END_DECODE
NOT_5:		
		CJNE	R2,#0BDH,NOT_6
		MOV	R3,#6
		SJMP	END_DECODE
NOT_6:		
		CJNE	R2,#0EBH,NOT_7
		MOV	R3,#7
		SJMP	END_DECODE
NOT_7:		
		CJNE	R2,#0DBH,NOT_8
		MOV	R3,#8
		SJMP	END_DECODE
NOT_8:		
		CJNE	R2,#0BBH,NOT_9
		MOV	R3,#9
		SJMP	END_DECODE
NOT_9:		
		CJNE	R2,#07EH,NOT_A
		MOV	R3,#0AH
		SJMP	END_DECODE
NOT_A:		
		CJNE	R2,#07DH,NOT_B
		MOV	R3,#0BH
		SJMP	END_DECODE
NOT_B:		
		CJNE	R2,#07BH,NOT_C
		MOV	R3,#0CH
		SJMP	END_DECODE
NOT_C:		
		CJNE	R2,#077H,NOT_D
		MOV	R3,#0DH
		SJMP	END_DECODE
NOT_D:		
		CJNE	R2,#0E7H,NOT_E
		MOV	R3,#0EH
		SJMP	END_DECODE
NOT_E:		
		MOV	R3,#0FH
END_DECODE:	
		RET
END