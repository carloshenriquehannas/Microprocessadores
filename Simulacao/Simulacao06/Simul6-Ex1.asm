;Carlos Henrique Hannas de Carvalho
;NUSP: 11965988

PROG:
		ACALL	INICIAR_LCD
		MOV	R5,#0

LOOP:
		MOV	R4,#7FH
		ACALL	PEGA_TECLA
		ACALL	DECODE
		MOV	A,R5
		ACALL	POS_LCD
		INC	R5
		MOV	A,R3
		ACALL	NBR_TO_ASC
		ACALL	ESCREVE_TEXTO
		SJMP	LOOP

PEGA_TECLA:
		MOV	A,R4		
		MOV	P1,A
		RR	A
		MOV	R4,A
		JB	A.3,NOT_RESET
		MOV	R4,#7FH
NOT_RESET:	
		MOV	A,P1
		MOV	R2,A
		ORL	A,#0F0H
		CJNE	A,#0FFH,GOT_KEY
		SJMP	PEGA_TECLA
GOT_KEY:	RET

INICIAR_LCD:
		CLR	P3.3
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#38H
		CLR	P3.2
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#0EH
		CLR	P3.2
		SETB	P3.2
		CLR	P3.4
		MOV	P2,#06H
		CLR	P3.2
		RET
POS_LCD:
		CLR	P3.3
		SETB	P3.2
		CLR	P3.4
		ADD	A,#80H
		MOV	P2,A
		CLR	P3.2
		RET
ESCREVE_TEXTO:
		CLR	P3.3
		SETB	P3.2
		SETB	P3.4
		MOV	P2,A
		CLR	P3.2
		RET

NBR_TO_ASC:
		CJNE	A,#0AH,TEST
		TEST:	JC	NUM
		ADD	A,#07H
NUM:		
		ADD	A,#30H
		RET

DECODE:		
		CJNE	R2,#0D7H,NOT0
		MOV	R3,#0
		SJMP	END_DECODE
NOT0:		
		CJNE	R2,#0EEH,NOT1
		MOV	R3,#1
		SJMP	END_DECODE
NOT1:		
		CJNE	R2,#0DEH,NOT2
		MOV	R3,#2
		SJMP	END_DECODE
NOT2:		
		CJNE	R2,#0BEH,NOT3
		MOV	R3,#3
		SJMP	END_DECODE
NOT3:		
		CJNE	R2,#0EDH,NOT4
		MOV	R3,#4
		SJMP	END_DECODE
NOT4:		
		CJNE	R2,#0DDH,NOT5
		MOV	R3,#5
		SJMP	END_DECODE
NOT5:		
		CJNE	R2,#0BDH,NOT6
		MOV	R3,#6
		SJMP	END_DECODE
NOT6:		
		CJNE	R2,#0EBH,NOT7
		MOV	R3,#7
		SJMP	END_DECODE
NOT7:		
		CJNE	R2,#0DBH,NOT8
		MOV	R3,#8
		SJMP	END_DECODE
NOT8:		
		CJNE	R2,#0BBH,NOT9
		MOV	R3,#9
		SJMP	END_DECODE
NOT9:		
		CJNE	R2,#07EH,NOTA
		MOV	R3,#0AH
		SJMP	END_DECODE
NOTA:		
		CJNE	R2,#07DH,NOTB
		MOV	R3,#0BH
		SJMP	END_DECODE
NOTB:		
		CJNE	R2,#07BH,NOTC
		MOV	R3,#0CH
		SJMP	END_DECODE
NOTC:		
		CJNE	R2,#077H,NOTD
		MOV	R3,#0DH
		SJMP	END_DECODE
NOTD:		
		CJNE	R2,#0E7H,NOTE
		MOV	R3,#0EH
		SJMP	END_DECODE
NOTE:		
		MOV	R3,#0FH
END_DECODE:	
		RET

END