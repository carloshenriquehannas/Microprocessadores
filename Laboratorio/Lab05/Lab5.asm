;Carlos Henrinque Hannas de Carvalho
;NUSP: 11965988

	ORG	0000H
	SJMP	PROGRAM

	ORG	0003H
	SJMP	INTERRUPT_INC

	ORG	0013H
	SJMP	INTERRUPT_DEC

INTERRUPT_INC:
	CLR	EA

	MOV	R3,#00H
	MOV	R4,#01H
	
	SETB	EA
	RETI

INTERRUPT_DEC:
	CLR	EA

	MOV	R3,#01H
	MOV	R4,#01H
	
	SETB	EA
	RETI

PROGRAM:

	SETB	EX0	;Interrupcao externa 0
	SETB	IT0
	SETB	EX1	;Interrupcao externa 1
	SETB	IT1
	SETB	EA
	SETB	P3.0

	MOV	30H,#11000000B
	MOV	31H,#11000000B
	MOV	32H,#11000000B
	MOV	33H,#11000000B
	MOV	34H,#00000000B

	MOV	R3,#00
	MOV	R4,#00

	MOV	20H,#01H
	MOV	21H,#01H
	MOV	22H,#01H
	MOV	23H,#01H
	MOV	24H,#00H

	ACALL	DISP_MUX
	MOV	DPTR,#TAB

LOOP:

	MOV	A,R4
	JZ	FSUBT

	CLR	A
	MOV	A,P3
	ANL	A,#01H
	MOV	R4,A
	
	
	CLR	A
	
	MOV	A,20H
	MOVC	A,@A+DPTR
	MOV	30H,A

	MOV	A,21H
	MOVC	A,@A+DPTR
	MOV	31H,A

	MOV	A,22H
	MOVC	A,@A+DPTR
	MOV	32H,A

	MOV	A,23H
	MOVC	A,@A+DPTR
	MOV	33H,A

	CLR	A
	
	CJNE	R3,#01,INCR
	
	ACALL	SUBTMEM

	MOV	A,R4
	
	SJMP	FSUBT
	
INCR:

	ACALL	INCRMEM
	
FSUBT:	

	
	
	ACALL	DISP_MUX
	ACALL	DELAYCTN
	

	SJMP	LOOP

INCRMEM:
	CLR	A

	MOV	A,20H
	CJNE	A,#10D,INCR20
	
	MOV	20H,#01H


	MOV	A,21H
	CJNE	A,#10D,INCR21

	MOV	21H,#01H


	MOV	A,22H
	CJNE	A,#10D,INCR22

	MOV	22H,#01H

	MOV	A,23H
	CJNE	A,#10D,INCR23

	MOV	23H,#01H
	
	RET
	
INCR20:
	INC	20H
	RET

INCR21:
	INC	21H
	RET

INCR22:
	INC	22H
	RET

INCR23:
	INC	23H
	RET

	
SUBTMEM:
	CLR	A

	MOV	A,20H
	CJNE	A,#01D,DECR20
	
	MOV	20H,#10D

	MOV	A,21H
	CJNE	A,#01D,DECR21

	MOV	21H,#10D

	MOV	A,22H
	CJNE	A,#01D,DECR22

	MOV	22H,#10D

	MOV	A,23H
	
	CJNE	A,#01D,DECR22

	MOV	23H,#10D

	RET	

DECR20:
	DEC	20H
	RET

DECR21:
	DEC	21H
	RET

DECR22:
	DEC	22H
	RET

	
DISPLAY:
	MOV	P0,#00H
	MOV	DPTR,#TAB
	MOVC	A,@A+DPTR
	MOV	P0,A
	RET

DISP_MUX:
	MOV	R2,A
	MOV	R0,#30H
	MOV	A,#01
	SWAP	A
	CPL	A
CONT:	ACALL	APAGA

	MOV	P0,@R0
	MOV	P2,A
	ACALL	DELAY
	ACALL	APAGA
	RL	A
	INC	R0
	CJNE	R0,#34H,DIGIT
DIGIT:	JC	CONT
	ACALL	APAGA
	MOV	A,R2
	RET

APAGA:
	MOV	P0,#0FFH
	MOV	P2,#0FFH
	RET

DELAY:

	MOV	R6, #02Fh
	MOV	R7, #02Fh
	NOP
	DJNZ	R7, $
	DJNZ	R6, $-5
	NOP
	
	RET

DELAYCTN:

	MOV	R6, #02Fh
	MOV	R7, #02Fh
	NOP
	DJNZ	R7, $
	DJNZ	R6, $-5
	NOP
	
	RET

TAB: DB 0C0H, 0F9H, 0A4H, 0B0H, 99H, 92H, 82H, 0F8H, 80H, 90H

END